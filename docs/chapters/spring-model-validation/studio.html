<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Studio: Spa User Validation &#8212; Java Web Development  documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/site.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body class="body-bc">

<div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
        </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<ol class="breadcrumb container">
    <li><a href="../../index.html">Contents</a></li>
    <li class="active">Studio: Spa User Validation</li>
</ol>



<div class="container">
  <div class="row">
    <div class="col-md-10 col-md-offset-1 content ">

    
  <div class="section" id="studio-spa-user-validation">
<h1>Studio: Spa User Validation<a class="headerlink" href="#studio-spa-user-validation" title="Permalink to this headline">¶</a></h1>
<p>We’ll build on the <a class="reference external" href="../user-signup/" target="_blank">User Signup<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> studio from last
class, adding in model validation.</p>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Open up your <code class="docutils literal notranslate"><span class="pre">cheese-mvc</span></code> application and navigate to the <code class="docutils literal notranslate"><span class="pre">User</span></code>
model class.</p>
</div>
<div class="section" id="add-validation-annotations">
<h2>Add Validation Annotations<a class="headerlink" href="#add-validation-annotations" title="Permalink to this headline">¶</a></h2>
<p>Let’s take our first steps toward enabling validation. Add <a class="reference external" href="http://docs.oracle.com/javaee/6/tutorial/doc/gircz.html" target="_blank">validation
annotations<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>
to ensure these conditions are satisfied:</p>
<ul>
<li><p class="first">Username, password, and verify are required (they can’t be empty)</p>
</li>
<li><p class="first">Username is between 5 and 15 characters</p>
</li>
<li><p class="first">Email is optional</p>
</li>
<li><p class="first">If provided, the email has the format of a valid email address.</p>
<p><strong>How to do this</strong>: The Java Validation API doesn’t provide an
annotation to validate an email address. However, one is provided by
the <a class="reference external" href="https://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#validator-defineconstraints-hv-constraints" target="_blank">Hibernate
Validator<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>
library. This library is already in your project, since it’s included
in the <code class="docutils literal notranslate"><span class="pre">spring-boot-starter-web</span></code> dependency that’s part of our
Gradle configuration. You can use any of these annotations in the
same way you’ve been using the Java Validation API annotations.</p>
</li>
<li><p class="first">The password and verify fields match.</p>
<p><strong>How to do this</strong>: Your <code class="docutils literal notranslate"><span class="pre">verify</span></code> parameter in the form handler is
not part of the user class, so checking that the <code class="docutils literal notranslate"><span class="pre">User</span></code> object’s
password matches the <code class="docutils literal notranslate"><span class="pre">verify</span></code> isn’t possible using validation
annotations. We’ll walk through these details on how to manually
conduct this check below.</p>
</li>
<li><p class="first">The password is at least 6 characters long</p>
</li>
</ul>
</div>
<div class="section" id="using-the-model-to-render-the-form">
<h2>Using the Model to Render the Form<a class="headerlink" href="#using-the-model-to-render-the-form" title="Permalink to this headline">¶</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">UserController</span></code>, modify the <code class="docutils literal notranslate"><span class="pre">add</span></code> method that displays the
form so that it passes in an “empty” <code class="docutils literal notranslate"><span class="pre">User</span></code> object with:</p>
<div class="code java highlight-none notranslate"><div class="highlight"><pre><span></span>model.addAttribute(new User());
</pre></div>
</div>
<p>This object will be accessible in the template, by name, as <code class="docutils literal notranslate"><span class="pre">user</span></code>.
Within the template, use this object within the form by adding
<code class="docutils literal notranslate"><span class="pre">th:object=&quot;${user}&quot;</span></code> to the form element. Then you can use the
<code class="docutils literal notranslate"><span class="pre">th:for</span></code>, <code class="docutils literal notranslate"><span class="pre">th:field</span></code> and <code class="docutils literal notranslate"><span class="pre">th:errors</span></code> tags within the form as
outlined in the <a class="reference external" href="../../videos/intro-to-spring-boot-model-validation" target="_blank">lesson on
validation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>.</p>
<p>While you’re in the <code class="docutils literal notranslate"><span class="pre">add.html</span></code> template, make sure that the password
and verify fields have <code class="docutils literal notranslate"><span class="pre">type=&quot;password&quot;</span></code> in the form markup, and that
the email field has <code class="docutils literal notranslate"><span class="pre">type=&quot;email&quot;</span></code>.</p>
<aside class="aside-pro-tip"><p>This last item will provide some client-side validation on the email
field, but we shouldn’t consider that sufficient. Even with client-side
validation (that is, in the browser), you should always validate data on
the server as well. You might want to provide constraints in addition to
or beyond what the browser does, and it’s also possible for a clever
(or, more often, malicious) user to bypass the browser’s validation.</p>
</aside></div>
<div class="section" id="validating-form-submission-data">
<h2>Validating Form Submission Data<a class="headerlink" href="#validating-form-submission-data" title="Permalink to this headline">¶</a></h2>
<aside class="aside-warning"><p>If you did any of the Bonus Missions in the previous studio, you’ll be
tearing out some of that code, since we’ll now have the framework handle
validation. Don’t worry, it’ll be worth it!</p>
</aside><p>Now that you have your form set up, go back to <code class="docutils literal notranslate"><span class="pre">UserController</span></code> and
add validation on form submission by adding the <code class="docutils literal notranslate"><span class="pre">&#64;Valid</span></code> annotation to
the <code class="docutils literal notranslate"><span class="pre">User</span></code> parameter that is bound, along with an additional
parameter: <code class="docutils literal notranslate"><span class="pre">Errors</span> <span class="pre">errors</span></code>. <strong>You must put this parameter directly
after the ``User`` parameter in the method definition for it to work
properly.</strong></p>
<p>Within the <code class="docutils literal notranslate"><span class="pre">add</span></code> handler, check for errors configured by the
validation annotation using <code class="docutils literal notranslate"><span class="pre">errors.hasErrors()</span></code>. If this returns
<code class="docutils literal notranslate"><span class="pre">true</span></code>, return the user to the form. Be sure to add the <code class="docutils literal notranslate"><span class="pre">user</span></code>
object to the <code class="docutils literal notranslate"><span class="pre">model</span></code> in this case: <code class="docutils literal notranslate"><span class="pre">model.addAttribute(user)</span></code>. The
<code class="docutils literal notranslate"><span class="pre">user</span></code> object contains the error messages associated with validation.</p>
<div class="section" id="validating-that-passwords-match">
<h3>Validating That Passwords Match<a class="headerlink" href="#validating-that-passwords-match" title="Permalink to this headline">¶</a></h3>
<p>As we mentioned above, we are not able to use Spring’s validation
machinery to validate that the two password fields match given the setup
we have here. Checking <code class="docutils literal notranslate"><span class="pre">errors.hasErrors()</span></code> will only tell us if there
are errors in other form data fields.</p>
<p>To check that the two password fields match, you’ll need to manually
compare them. At this point, our method signature is:</p>
<div class="code java highlight-none notranslate"><div class="highlight"><pre><span></span>public String add(Model model, @ModelAttribute @Valid User user,
                      Errors errors, String verify)
</pre></div>
</div>
<p>We can access the primary password field by using
<code class="docutils literal notranslate"><span class="pre">user.getPassword()</span></code>. Make sure that neither this value nor the
<code class="docutils literal notranslate"><span class="pre">verify</span></code> variable are null, and then compare them with <code class="docutils literal notranslate"><span class="pre">.equals()</span></code>.
If one of them is null, or if they don’t match, then add a custom error
message to <code class="docutils literal notranslate"><span class="pre">model</span></code> and clear the password field so it isn’t displayed
when we return the form: <code class="docutils literal notranslate"><span class="pre">user.setPassword(&quot;&quot;)</span></code>. Finally, return the
form, and manually add markup in <code class="docutils literal notranslate"><span class="pre">add.html</span></code> to display this error.</p>
<p>Now we have two validation sections: one for the annotation-configured
validation (which checks <code class="docutils literal notranslate"><span class="pre">errors.hasErrors()</span></code>), and one that checks
that the password fields match. Make sure they work in-sync with each
other to properly return to the form if any of the validation conditions
fail.</p>
<aside class="aside-pro-tip"><p>You can, in fact, validate that passwords match using annotations by
taking a slightly more difficult approach than we’ve done here. We
outline how to do so in the Bonus Mission section.</p>
</aside></div>
</div>
<div class="section" id="test-test-test">
<h2>Test, Test, Test!<a class="headerlink" href="#test-test-test" title="Permalink to this headline">¶</a></h2>
<p>You made a lot of changes! Be sure to throughly test them to make sure
everything works as expected.</p>
</div>
<div class="section" id="bonus-mission">
<h2>Bonus Mission<a class="headerlink" href="#bonus-mission" title="Permalink to this headline">¶</a></h2>
<p>Let’s set up our <code class="docutils literal notranslate"><span class="pre">User</span></code> class so we can validate that the password
fields match using annotations.</p>
<ol class="arabic simple">
<li>Add a <code class="docutils literal notranslate"><span class="pre">private</span> <span class="pre">String</span> <span class="pre">verifyPassword</span></code> field to <code class="docutils literal notranslate"><span class="pre">User</span></code>, along with
getters and setters.</li>
<li>Add a new method, <code class="docutils literal notranslate"><span class="pre">private</span> <span class="pre">void</span> <span class="pre">checkPassword</span></code>, that compares
<code class="docutils literal notranslate"><span class="pre">password</span></code> and <code class="docutils literal notranslate"><span class="pre">verifyPassword</span></code>. If neither is <code class="docutils literal notranslate"><span class="pre">null</span></code> and they
don’t match, then set <code class="docutils literal notranslate"><span class="pre">verifyPassword</span> <span class="pre">=</span> <span class="pre">null</span></code>.</li>
<li>In both <code class="docutils literal notranslate"><span class="pre">setPassword</span></code> and <code class="docutils literal notranslate"><span class="pre">setVerifyPassword</span></code>, call
<code class="docutils literal notranslate"><span class="pre">checkPassword</span></code> <strong>after</strong> setting the given field.</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">&#64;NotNull</span></code> to the <code class="docutils literal notranslate"><span class="pre">verifyPassword</span></code> field with the error
message: “Passwords do not match”.</li>
<li>Refactor the controller and <code class="docutils literal notranslate"><span class="pre">add.html</span></code> template to use the
built-in, annotation-based validation instead of the manual password
validation that we carried out previously. Be sure to update the
verify field and label in the form to use the field on the <code class="docutils literal notranslate"><span class="pre">User</span></code>
class, and to remove <code class="docutils literal notranslate"><span class="pre">String</span> <span class="pre">verify</span></code> from the <code class="docutils literal notranslate"><span class="pre">add</span></code> method
signature.</li>
</ol>
<p>The result of these changes is that when the <code class="docutils literal notranslate"><span class="pre">User</span></code> object is bound to
the request, both <code class="docutils literal notranslate"><span class="pre">password</span></code> and <code class="docutils literal notranslate"><span class="pre">verifyPassword</span></code> are set. Spring
does this by calling the setters on these fields. The setters call
<code class="docutils literal notranslate"><span class="pre">checkPassword</span></code>, so when the second one is set (whichever that may
be), we’ll know that both <code class="docutils literal notranslate"><span class="pre">password</span></code> and <code class="docutils literal notranslate"><span class="pre">verifyPassword</span></code> are not
<code class="docutils literal notranslate"><span class="pre">null</span></code> and we’ll compare them. If they don’t match, we manually
violate the <code class="docutils literal notranslate"><span class="pre">&#64;NotNull</span></code> validation on <code class="docutils literal notranslate"><span class="pre">verifyPassword</span></code> by setting
that field to <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
</div>
</div>



    
    <nav aria-label="Next and Previous Pages">
      <ul class="pager">
        
        
      </ul>
    </nav>
    
    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/chapters/spring-model-validation/studio.rst.txt"
     rel="nofollow">Page Source</a>
</div>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>